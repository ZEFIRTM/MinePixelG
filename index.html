<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Unity WebGL Player</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/@tonconnect/sdk@2.1.3/dist/tonconnect-sdk.min.js"></script>
    <script>
        window.addEventListener('load', function() {
            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.ready();
                window.Telegram.WebApp.expand();
            }
        });
    </script>
    <style>
        body { margin: 0; overflow: hidden; background-color: #000000; }
        #loadingScreen {
            position: fixed;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #000000;
            z-index: 9999;
        }
        #loadingScreen img {
            max-width: 200px;
            max-height: 200px;
        }
        #mobileInputField {
            position: absolute;
            top: -9999px;
            left: -9999px;
            z-index: -1;
            opacity: 0;
        }
    </style>
</head>
<body>
    <div id="loadingScreen">
        <img src="Assets/Textures/Other/MineCoin.png" alt="Loading...">
    </div>

    <div id="gameContainer" style="width: 100%; height: 100%;"></div>
    <div id="connect-button" style="display: none;"></div>

    <input id="mobileInputField" type="text" />

    <script src="Build/TgWebGL.loader.js"></script>
    <script>
        window.unityInstance = null;

        // Инициализация TON Connect
        const initTonConnect = () => {
            try {
                console.log("Initializing TON Connect...");
                window.tonConnectUI = new TonConnect({
                    manifestUrl: 'https://zefirtm.github.io/MinePixelG/tonconnect-manifest.json'
                });
                console.log("TON Connect initialized successfully");
            } catch (error) {
                console.error("Error initializing TON Connect:", error);
            }
        };

        createUnityInstance(document.querySelector("#gameContainer"), {
            dataUrl: "Build/TgWebGL.data.unityweb",
            frameworkUrl: "Build/TgWebGL.framework.js.unityweb",
            codeUrl: "Build/TgWebGL.wasm.unityweb",
            streamingAssetsUrl: "StreamingAssets",
            companyName: "d4rk_ltd",
            productName: "MinePixel",
            productVersion: "0.1.0",
        }).then(function(instance) {
            window.unityInstance = instance;
            document.getElementById("loadingScreen").style.display = 'none';
            // Инициализируем TON Connect после загрузки Unity
            initTonConnect();
        }).catch(function(error) {
            console.error('Unity initialization error:', error);
        });

        function focusMobileInputField() {
            const input = document.getElementById("mobileInputField");
            if (input) {
                input.style.position = "absolute";
                input.style.top = "50%";
                input.style.left = "50%";
                input.style.transform = "translate(-50%, -50%)";
                input.style.zIndex = "9999";
                input.style.opacity = "1";
                input.focus();
            }
        }

        function hideMobileInputField() {
            const input = document.getElementById("mobileInputField");
            if (input) {
                input.style.position = "absolute";
                input.style.top = "-9999px";
                input.style.left = "-9999px";
                input.style.zIndex = "-1";
                input.style.opacity = "0";
                input.blur();
            }
        }

        function getMobileInputValue() {
            const input = document.getElementById("mobileInputField");
            return input ? input.value : "";
        }

        window.focusMobileInputField = focusMobileInputField;
        window.hideMobileInputField = hideMobileInputField;
        window.getMobileInputValue = getMobileInputValue;
    </script>
    <script src="ShowMobileKeyboard.js"></script>
</body>
</html> 
